# Hard Work - Сила низкоуровневых подходов

В целом, в работе в моем стартапе не используются проприетарные форматы данных, но все-таки попробую привести примеры, как мне кажется, относящийся к данной тематике.

## Пример 1

Для создания отчетов с данными для клиентов, в качестве первого решения использовали питоновскую библиотеку `Pandas`.

`Pandas` это одно из самых стандартных решений, когда дело касается манипулированием и преобразованием данными. `Pandas` предоставляет следующие возможности

1. Управление данными, подсчет метрик, создание расчетных столбцов.
2. Чтение и запись в распространенных форматах (.sql, .xlsx, .csv).

Но `Pandas` также обладает рядом недостатков:

1. Это довольно большая по размерам зависимость.
2. Хотя по скорости работы он сопоставим с БД, иногда отличается непомерным использованием RAM, что нередко приводит к проблемам с сервером. Базы данных, по опыту, гораздо лучше оптимизированы под различный уровень нагрузки, при необходимости могут "сгружать" данные на диск (это умеет также расширение для пандаса - `Dask`, но это еще одна зависимость).

При умелом обращении большинство задач `Pandas` можно переложить на БД, при этом мы сильно экономим на потоке данных передавая не сырые, а уже обработанные данные.
Для очень специфичных изменений, легко использовать стандартные инстументы `Python`, такие как модуль `csv`. Возможно не подгружать весь отчет в память, а обрабатывать и записывать его по кусочкам.
Модуль `scp` позволяет удаленно создавать файл отчета уже на сервере клиента.

Таким образом, средств БД и стандартной библиотеки `Python` может быть вполне достаточно и мы можем не добавлять существенные зависимости в наш проект.

## Пример 2

BI инструмент `Tableau` который мы используем в работе, стандартно предполагает использование базы данных, из которой данные подтягиваются в дашборд, и бд как `Clickhouse`.

Однако, `Tableau` также поддерживает возможность создания "экстрактов" - своего внутреннего формата хранения данных. У него есть ряд как плюсов (быстрота, независимость от работы БД в моменте) так и недостатков (необходимость обновления из БД, дополнительное место на сервере).

Также, одним из больших недостатков (субъективно) является использование формата `xml` для взаимодействия `Tableau` с экстрактами. Чем именно это плохо? На мой взгляд в плане читаемости, формат `xml` особенно сложен для восприятия, но это не главное. Если мы хотим на программном уровне вмешаться в работу запросов, нам в идеале нужно поддерживать 2 варианта для работы с `SQL` запросами к базе данных и `xml` для работы с экстрактами.

Одним из решений данной проблемы, как я думаю, может быть небольшая программа для парсинга и преобразования `SQL` запросов в таблошный формат `xml`, который был бы понятен для сервера `Tableau`.

Таким образом, можно будет поддерживать один набор запросов, который был бы универсальным при любом варианте работы, как с обычной БД так и с форматом экстрактов.

Краткий поиск в гугле показал, что уже существуют готовые инструменты (но они довольно сырые) для работы с `Tableau`шным `XML` форматов. (возможно, добавлю в беклог на 24 год написание такой библиотеки самостоятельно).

## Выводы

Данное занятие, как и **"Some Were Meant for C"** очень сильно мотивируют все таки заняться изучением языка Си :). 
На мой взгляд, они о том, что инструменты, которые облегчают нам работу с тем или иным форматом данных зачастую также создают значительный "оверхэд", который совсем не обязателен в нашей работе. Когда в этом есть смысл, может быть полезно спуститься на уровень ниже (сделать шаг дальше от высокоуровневых абстракций и ближе к данным как потоку байтов). Как и в большинстве случаев, такое решение это всегда "трейд-офф" между удобством нашей работы и выигрышом, который мы получим с одной стороны в эффективности, с другой также в понимании процессов, которые мы используем.