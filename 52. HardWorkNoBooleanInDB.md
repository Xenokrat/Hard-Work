# Hard Work - Отказываемся от хранения логических значений

# Пример 1

Рассмотрим следующий пример.
Мы предоставляем клиенту API, который позволяет следить за эффективностью продажи его продуктов в сервисах
доставки. В определенные моменты времени товар в конкретной точке доставки может быть как доступен для продажи,
так и по какой-либо причине не доступен, что может быть связано с тем, что товар закончился, или по какой-то причине
вообще не представлен в линейке продуктов.
В прошлом мы использовли для того, чтобы указать, что продукт из линейки клиента в данный момент недоступен, булевое значение в БД.
Теперь, когда мы применим методику, предложенную в данном занятии, получится следующее.
Теперь это поле `availability` будет содержать информацию о том, когда продукт последний раз был доступен для продажи.
В случае, когда в записи будет стоять `NULL` это будет означать, что продукт в принципе не был доступен в данной точке.

Перечислим плюсы:
- Такой подход во многом облегчает аналитику, т.к. клиентам часто бывает интересно, в какой момент времени их товар был доступен в последний раз.
- Легко разделить магазины, где товар никогда не был доступен, от магазинов где он закончился.

# Пример 2

Описанную логику в п.1 можно распространить и на доступность точек доставок - мы можем отслеживать не только 
доступность товаров, но и доступность точек. Например, определять в какой момент времени точка могла закрыться, например,
на выходной.

Плюсы:
- Легко вычислить точки доставки, которые полностью закрылись (например, у них будет последнее обновление больше месяца от даты проверки).
- Легко найти точки доставки, которые "обнаружены", но к ним нельзя подключиться/нет доступных товаров.

# Пример 3

Последняя попытка переподключиться к серверу
При использовании сервиса, который предоставляет менеджерам статистику по использовании данных.
В целом, такие запросы интересно логировать, и отмечать, выдал ли указанный запрос какую-либо информацию из БД
или привёл к ошибке (еще возможно, что за запрошенный период просто нет таких данных).
Также, применим эту технологию, чтобы заменить булевое значение в логе на `timestamp`.

Теперь получается, что столбец показывает дату последнего успешно выполненного обращения к БД.
Кроме того, мы получаем информацию о различию между датой обращения в БД (это отдельный столбец) и датой успешно
возвращенного ответа, и оценить, был ли он возвращен успешно.
Таким образом, можно отсечь запросы, которые выполняются слишком долго, и проанализировать их.
Можно быстро получать NULL значения, чтобы анализировать обращения, которые не были обработаны корректно.



# Выводы

При желании, в данной методике можно найти и минусы. Например, в Clickhouse использование Nullable колонки сопряжено с дополнительными затратами Clikchouse не поддерживает напрямую NULL значения, создавая вместо этого скрытый булевый столбец для обозначения, таким образом, мы все равно "используем" булевый столбец. 
Также, значения в таком столбце будут занимать больше места, и некоторые запросы могут выполняться быстрее на чисто булевом столбце (хотя запросы на NULL должны быть быстрыми), поэтому, как мне кажется, это не на 100% универсальное решение.
В целом, однако, преимущества, которые даёт вот такой "трюк" кажутся мне значительными, особенно удобно использовать такие значения для аналитики, так как они по сути заменяют собой дополнительный `timestamp` столбец, при этом фактически выполняя такую же роль.
Поэтому я абсолютно точно буду часто находить применение такой технологии.
